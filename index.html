<!doctype html>
<html lang="pl">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0ff">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>Gravity Flip</title>
<style>
  :root {
    --bg: #0a0a0a;
    --ground: #1a1a1a;
    --accent: #0ff;
    --text: #e2e2e2;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', system-ui, sans-serif;
    overflow: hidden;
  }
  #gameWrap {
    position: absolute;
    top: 25%;
    left: 15%;
    right: 15%;
    bottom: 25%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  canvas {
    background: linear-gradient(#0d0d0d,#000);
    border: 2px solid #222;
    border-radius: 8px;
    touch-action: none;
    display: block;
  }
  #score {
    position: fixed;
    right: 18px;
    top: 18px;
    font-weight: 700;
    color: var(--accent);
    font-size: 20px;
    text-shadow: 0 0 8px var(--accent);
  }
  #msg {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: rgba(15,15,15,0.9);
    padding: 16px 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 30px rgba(0,255,255,0.3);
  }
  #msg h2 { margin: 0; font-size: 18px; color: var(--accent); }
  #msg small { color: #888; }
  #restartBtn {
    background: var(--accent);
    color: #000;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 8px;
  }
  #discord{
    position:fixed;
    bottom:14px;
    left:50%;
    transform:translateX(-50%);
    background:linear-gradient(90deg,#5865f2,#7289da);
    color:white;
    padding:10px 20px;
    border-radius:20px;
    text-decoration:none;
    font-weight:700;
    font-size:16px;
    box-shadow:0 0 20px rgba(88,101,242,0.6);
    transition:transform .2s, box-shadow .2s;
  }
  #discord:hover{transform:translateX(-50%) scale(1.05);box-shadow:0 0 30px rgba(88,101,242,0.9);}
</style>
</head>
<body>
<div id="gameWrap">
  <canvas id="game"></canvas>
</div>
<div id="score">0</div>
<div id="msg">
  <h2 id="msgTitle">Tap / Space żeby zacząć</h2>
  <small id="msgSub">Best: 0</small><br>
  <button id="restartBtn" style="display:none;">Restart</button>
</div>
<a id="discord" href="https://discord.gg/fj2XaFxDte" target="_blank">Discord</a>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const DPR = window.devicePixelRatio || 1;

  let BASE_W = 900;
  let BASE_H = 300;
  let scale = 1;

  const groundTopBase = 60;
  const groundBottomBase = 260;

  function resize() {
    const wrap = document.getElementById('gameWrap');
    let w = wrap.clientWidth;
    let h = wrap.clientHeight;

    canvas.width = w * DPR;
    canvas.height = h * DPR;
    ctx.setTransform(DPR,0,0,DPR,0,0);

    scale = Math.min(w / BASE_W, h / BASE_H);
  }

  window.addEventListener('resize', resize);
  resize();

  let score = 0, best = parseInt(localStorage.getItem('flip_best')||'0',10);
  let running = false, alive = true, speed = 260, baseSpeed = 260;
  let spawnTimer = 0;
  const obstacles = [];
  const scoreEl = document.getElementById('score');
  const msg = document.getElementById('msg');
  const msgTitle = document.getElementById('msgTitle');
  const msgSub = document.getElementById('msgSub');
  const restartBtn = document.getElementById('restartBtn');

  const player = {
    x: 100, y: groundBottomBase-40, w:40, h:40,
    onCeiling: false, vy:0, targetY: groundBottomBase-40, flippedOnce:false,
    flip() {
      this.onCeiling = !this.onCeiling;
      this.targetY = this.onCeiling ? groundTopBase : groundBottomBase- this.h;
      this.flippedOnce = true;
      playFlipSound();
      spawnWave(this.x + this.w/2, this.y + this.h/2, "#0ff");
      spawnNeonFlash();
    },
    update(dt) {
      this.y += (this.targetY - this.y) * Math.min(12*dt,1);
    },
    draw() {
      ctx.save();
      ctx.shadowColor = "#0ff";
      ctx.shadowBlur = 15;
      ctx.fillStyle = "#0ff";
      ctx.fillRect(this.x*scale, this.y*scale, this.w*scale, this.h*scale);
      ctx.restore();
    },
    bounds() { return {x:this.x*scale,y:this.y*scale,w:this.w*scale,h:this.h*scale}; }
  };

  function drawSpike(x,y,size,inverted=false){
    ctx.save();
    ctx.beginPath();
    if(inverted){
      // górny trójkąt w dół
      ctx.moveTo(x*scale, y*scale);
      ctx.lineTo((x+size/2)*scale, (y+size)*scale);
      ctx.lineTo((x+size)*scale, y*scale);
    } else {
      // dolny trójkąt w górę
      ctx.moveTo(x*scale, (y+size)*scale);
      ctx.lineTo((x+size/2)*scale, y*scale);
      ctx.lineTo((x+size)*scale, (y+size)*scale);
    }
    ctx.closePath();
    ctx.fillStyle="#ff0000";
    ctx.shadowColor="#ff0000";
    ctx.shadowBlur=20;
    ctx.fill();
    ctx.restore();
  }

  class Obstacle {
    constructor(x,type){
      this.x=x; this.w=30; this.h=30; this.type=type;
    }
    update(dt){this.x -= speed*dt;}
    draw(){
      const inverted = this.type==='top'?true:false;
      const y = this.type==='bottom'?groundBottomBase-this.h:groundTopBase;
      drawSpike(this.x,y,this.h,inverted);
    }
    bounds(){
      const y = this.type==='bottom'?groundBottomBase-this.h:groundTopBase;
      return {x:this.x*scale,y:y*scale,w:this.w*scale,h:this.h*scale};
    }
  }

  function intersect(a,b){
    return !(a.x+a.w<b.x || b.x+b.w<a.x || a.y+a.h<b.y || b.y+b.h<a.y);
  }

  const waveEffects=[];
  function spawnWave(x,y,color="#0ff"){waveEffects.push({x,y,r:0,alpha:1,color});}
  function drawWave(dt){
    for(let i=waveEffects.length-1;i>=0;i--){
      let w=waveEffects[i];
      w.r+=400*dt; w.alpha-=1.5*dt;
      if(w.alpha<=0) waveEffects.splice(i,1);
      else{
        ctx.beginPath();
        ctx.strokeStyle=`${w.color.replace("0ff","0ff")}`; // zachowuje kolor gracza
        ctx.lineWidth=3;
        ctx.arc(w.x*scale,w.y*scale,w.r*scale,0,Math.PI*2);
        ctx.stroke();
      }
    }
  }

  let audioCtx=null;
  function ensureAudio(){if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();}
  function playFlipSound(){
    ensureAudio();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain(), now=audioCtx.currentTime;
    o.type='square'; o.frequency.setValueAtTime(500,now);
    o.frequency.exponentialRampToValueAtTime(180,now+0.18);
    g.gain.setValueAtTime(0.25,now);
    g.gain.exponentialRampToValueAtTime(0.0001,now+0.3);
    o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(now+0.3);
  }

  function spawnNeonFlash(){
    const gradient = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
    gradient.addColorStop(0,'rgba(0,255,255,0.2)');
    gradient.addColorStop(0.5,'rgba(0,255,255,0.4)');
    gradient.addColorStop(1,'rgba(0,255,255,0.2)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  function reset(){
    score=0; speed=baseSpeed; running=false; alive=true; obstacles.length=0;
    player.onCeiling=false; player.y=groundBottomBase-player.h; player.targetY=player.y; player.flippedOnce=false;
    msg.style.display='block'; msgTitle.textContent='Tap / Space żeby zacząć';
    msgSub.textContent='Best: '+best; restartBtn.style.display='none';
  }

  function gameOver(){
    alive=false; running=false;
    msg.style.display='block';
    msgTitle.textContent='Game Over';
    msgSub.textContent='Score: '+Math.floor(score)+' · Best: '+best;
    restartBtn.style.display='inline-block';
  }

  function spawnObstacle(){
    const side=Math.random()<0.5?'bottom':'top';
    obstacles.push(new Obstacle(BASE_W+50,side));
    spawnTimer=1.2+Math.random()*1.3;
  }

  function update(dt){
    if(!running||!alive) return;
    spawnTimer-=dt;
    if(spawnTimer<=0) spawnObstacle();
    for(let i=obstacles.length-1;i>=0;i--){
      obstacles[i].update(dt);
      if(obstacles[i].x + obstacles[i].w < -50) obstacles.splice(i,1);
    }
    for(const o of obstacles) if(intersect(player.bounds(),o.bounds())) return gameOver();
    player.update(dt);
    score += dt*60;
    if(score>best){best=Math.floor(score); localStorage.setItem('flip_best',best);}
    scoreEl.textContent=Math.floor(score);
    speed=baseSpeed+score*0.05;
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#111";
    ctx.fillRect(0,groundBottomBase*scale,canvas.width,4*scale);
    ctx.fillRect(0,groundTopBase*scale-4*scale,canvas.width,4*scale);

    obstacles.forEach(o=>o.draw());
    player.draw();
    drawWave(1/60);
  }

  let last=0;
  function loop(t){
    const dt=Math.min(0.05,(t-last)/1000);
    last=t;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  function flip(){
    if(!alive) return;
    if(!running){running=true; msg.style.display='none';}
    player.flip();
  }

  window.addEventListener('keydown',e=>{
    if(e.code==='Space'||e.code==='ArrowUp'){e.preventDefault(); if(!alive) reset(); else flip();}
  });
  canvas.addEventListener('pointerdown',e=>{
    e.preventDefault(); if(!alive) reset(); else flip();
  });
  restartBtn.addEventListener('click',reset);

  reset();
  requestAnimationFrame(loop);
})();
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').then(() => {
    console.log('Service Worker zarejestrowany kurwa!');
  });
}
</script>
</body>
</html>
